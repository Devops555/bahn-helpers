import { html } from 'htm/preact';
import { useEffect, useState } from 'preact/hooks';

import Helper from './Helper.js';

function updateHistory({ tag }) {
  // todo fix the back button
  history.pushState({}, document.title, `/${tag === 'all' ? '' : tag}`);
}

export function App({ helpers, tags, currentTag }) {
  const filterHelpers = (helpers, activeTag) =>
    activeTag === 'all'
      ? helpers
      : helpers.filter(helper => helper.tagSlugs.includes(activeTag));
  const [activeTag, setActiveTag] = useState(currentTag);
  const [activeHelpers, setActiveHelpers] = useState(
    filterHelpers(helpers, activeTag)
  );

  useEffect(() => {
    setActiveHelpers(filterHelpers(helpers, activeTag));
    updateHistory({ tag: activeTag });
  }, [activeTag]);

  return html`
    <div class="container">
      <div class="topbar">
        <a class="btn btn--ghost" href="https://twitter.com/tinyhelpersdev">
          Follow on Twitter
          <svg
            viewBox="-10 -10 310 310"
            height="320"
            width="320"
            focusable="false"
          >
            <g transform="translate(-539.17946,-568.85777)" id="layer1">
              <path
                id="path3611"
                d="m 633.89823,812.04479 c 112.46038,0 173.95627,-93.16765 173.95627,-173.95625 0,-2.64628 -0.0539,-5.28062 -0.1726,-7.90305 11.93799,-8.63016 22.31446,-19.39999 30.49762,-31.65984 -10.95459,4.86937 -22.74358,8.14741 -35.11071,9.62551 12.62341,-7.56929 22.31446,-19.54304 26.88583,-33.81739 -11.81284,7.00307 -24.89517,12.09297 -38.82383,14.84055 -11.15723,-11.88436 -27.04079,-19.31655 -44.62892,-19.31655 -33.76374,0 -61.14426,27.38052 -61.14426,61.13233 0,4.79784 0.5364,9.46458 1.58538,13.94057 -50.81546,-2.55686 -95.87353,-26.88582 -126.02546,-63.87991 -5.25082,9.03545 -8.27852,19.53111 -8.27852,30.73006 0,21.21186 10.79366,39.93837 27.20766,50.89296 -10.03077,-0.30992 -19.45363,-3.06348 -27.69044,-7.64676 -0.009,0.25652 -0.009,0.50661 -0.009,0.78077 0,29.60957 21.07478,54.3319 49.0513,59.93435 -5.13757,1.40062 -10.54335,2.15158 -16.12196,2.15158 -3.93364,0 -7.76596,-0.38716 -11.49099,-1.1026 7.78383,24.2932 30.35457,41.97073 57.11525,42.46543 -20.92578,16.40207 -47.28712,26.17062 -75.93712,26.17062 -4.92898,0 -9.79834,-0.28036 -14.58427,-0.84634 27.05868,17.34379 59.18936,27.46396 93.72193,27.46396"
              />
            </g>
          </svg>
        </a>

        <a class="btn btn--ghost" href="https://tiny-helpers.dev/feed.xml"
          >Check RSS
          <svg focusable="false" width="120" height="120" viewBox="0 0 120 120">
            <path
              d="m0 0v25c41.625 0 75 33.375 75 75h25c0-55.125-44.875-100-100-100zm0 37.5v25c20.875 0 37.5 16.625 37.5 37.5h25c0-34.375-28.125-62.5-62.5-62.5zm0 37.5v25h25c0-13.875-11.25-25-25-25z"
            />
          </svg>
        </a>

        <a
          class="btn btn--cta"
          href="https://github.com/stefanjudis/tiny-helpers#contributing"
          >Add helper
          <svg
            width="100"
            height="100"
            viewBox="0 0 100 100"
            aria-hidden="true"
            focusable="false"
          >
            <path
              d="m82.102 58h-24.102v24.102c0 4.3984-3.6016 8-8 8s-8-3.6016-8-8v-24.102h-24.102c-4.3984 0-8-3.6016-8-8s3.6016-8 8-8h24.102v-24.102c0-4.3984 3.6016-8 8-8s8 3.6016 8 8v24.102h24.102c4.3984 0 8 3.6016 8 8s-3.6016 8-8 8z"
              fill-rule="evenodd"
            />
          </svg>
        </a>
      </div>
      <div class="sidebar">
        <div class="sidebar__header">
          <svg width="187px" height="162px" viewBox="0 0 187 162">
            <title>robots</title>
            <defs>
              <polygon id="path-1" points="0 684 790 684 790 0 0 0"></polygon>
            </defs>
            <g
              id="Page-3"
              stroke="none"
              stroke-width="1"
              fill="none"
              fill-rule="evenodd"
            >
              <g id="robots" transform="translate(-77.000000, -325.000000)">
                <path
                  d="M170.0771,359.043 C170.0771,359.043 102.7471,357.244 104.8041,444.363 L170.0771,444.363 L235.3521,444.363 C237.4071,357.244 170.0771,359.043 170.0771,359.043"
                  id="Fill-74"
                  fill="#405fca"
                ></path>
                <mask id="mask-2" fill="white">
                  <use xlink:href="#path-1"></use>
                </mask>
                <g id="Clip-159"></g>
                <path
                  d="M128.8315,346.9082 C128.8315,351.9832 124.7185,356.0962 119.6445,356.0962 C114.5695,356.0962 110.4565,351.9832 110.4565,346.9082 C110.4565,341.8342 114.5695,337.7212 119.6445,337.7212 C124.7185,337.7212 128.8315,341.8342 128.8315,346.9082"
                  id="Fill-178"
                  fill="#405fca"
                  mask="url(#mask-2)"
                ></path>
                <polygon
                  id="Fill-179"
                  fill="#405fca"
                  mask="url(#mask-2)"
                  points="139.0537 380.7568 117.5307 348.3098 121.7587 345.5058 143.2807 377.9518"
                ></polygon>
                <path
                  d="M211.2788,346.9082 C211.2788,351.9832 215.3928,356.0962 220.4658,356.0962 C225.5398,356.0962 229.6538,351.9832 229.6538,346.9082 C229.6538,341.8342 225.5398,337.7212 220.4658,337.7212 C215.3928,337.7212 211.2788,341.8342 211.2788,346.9082"
                  id="Fill-180"
                  fill="#405fca"
                  mask="url(#mask-2)"
                ></path>
                <polygon
                  id="Fill-181"
                  fill="#405fca"
                  mask="url(#mask-2)"
                  points="201.0576 380.7568 196.8296 377.9518 218.3526 345.5058 222.5796 348.3098"
                ></polygon>
                <path
                  d="M212.2935,401.7021 C212.2935,410.3001 205.9475,417.2671 198.1195,417.2671 L139.8925,417.2671 C132.0645,417.2671 125.7175,410.3001 125.7175,401.7021 C125.7175,393.1051 132.0645,386.1371 139.8925,386.1371 L198.1195,386.1371 C205.9475,386.1371 212.2935,393.1051 212.2935,401.7021"
                  id="Fill-182"
                  fill="#FFFFFE"
                  mask="url(#mask-2)"
                ></path>
                <path
                  d="M162.2266,401.7021 C162.2266,407.8471 157.2466,412.8271 151.1016,412.8271 C144.9576,412.8271 139.9766,407.8471 139.9766,401.7021 C139.9766,395.5571 144.9576,390.5761 151.1016,390.5761 C157.2466,390.5761 162.2266,395.5571 162.2266,401.7021"
                  id="Fill-183"
                  fill="#405fca"
                  mask="url(#mask-2)"
                ></path>
                <path
                  d="M149.418,394.7178 C150.443,394.3818 151.682,394.2868 152.666,394.7878 C153.783,395.3588 154.245,396.8208 153.714,397.9818 C153.323,398.8368 152.614,398.9808 151.775,399.1398 C151.088,399.2708 150.47,399.4988 149.981,400.0208 C149.604,400.4248 149.384,400.9578 149.241,401.4878 C149.054,402.1808 148.816,402.9238 148.365,403.4948 C147.947,404.0208 147.314,404.2418 146.652,404.2538 C145.939,404.2668 145.126,404.1108 144.634,403.5458 C144.236,403.0878 144.1,402.4568 144.085,401.8648 C144.076,401.5248 144.098,401.1748 144.142,400.8378 C144.238,400.1188 144.414,399.4128 144.698,398.7438 C144.855,398.3728 145.048,398.0108 145.272,397.6758 C145.925,396.6978 146.823,395.8898 147.877,395.3658 C148.35,395.1328 148.875,394.8948 149.418,394.7178"
                  id="Fill-184"
                  fill="#FFFFFE"
                  mask="url(#mask-2)"
                ></path>
                <path
                  d="M200.6475,401.7021 C200.6475,407.8471 195.6675,412.8271 189.5225,412.8271 C183.3785,412.8271 178.3965,407.8471 178.3965,401.7021 C178.3965,395.5571 183.3785,390.5761 189.5225,390.5761 C195.6675,390.5761 200.6475,395.5571 200.6475,401.7021"
                  id="Fill-185"
                  fill="#405fca"
                  mask="url(#mask-2)"
                ></path>
                <path
                  d="M187.8389,394.7178 C188.8649,394.3818 190.1019,394.2868 191.0869,394.7878 C192.2039,395.3588 192.6659,396.8208 192.1349,397.9818 C191.7439,398.8368 191.0349,398.9808 190.1949,399.1398 C189.5089,399.2708 188.8919,399.4988 188.4019,400.0208 C188.0239,400.4248 187.8049,400.9578 187.6619,401.4878 C187.4749,402.1808 187.2369,402.9238 186.7859,403.4948 C186.3679,404.0208 185.7349,404.2418 185.0729,404.2538 C184.3599,404.2668 183.5459,404.1108 183.0569,403.5458 C182.6569,403.0878 182.5209,402.4568 182.5059,401.8648 C182.4969,401.5248 182.5189,401.1748 182.5629,400.8378 C182.6589,400.1188 182.8349,399.4128 183.1189,398.7438 C183.2759,398.3728 183.4699,398.0108 183.6929,397.6758 C184.3469,396.6978 185.2439,395.8898 186.2979,395.3658 C186.7709,395.1328 187.2959,394.8948 187.8389,394.7178"
                  id="Fill-186"
                  fill="#FFFFFE"
                  mask="url(#mask-2)"
                ></path>
                <path
                  d="M116.6553,341.0312 C117.2873,340.8242 118.0513,340.7652 118.6573,341.0752 C119.3463,341.4272 119.6313,342.3282 119.3023,343.0432 C119.0623,343.5702 118.6263,343.6592 118.1083,343.7572 C117.6843,343.8372 117.3033,343.9782 117.0023,344.3002 C116.7693,344.5482 116.6343,344.8782 116.5473,345.2052 C116.4313,345.6312 116.2843,346.0902 116.0063,346.4402 C115.7483,346.7642 115.3583,346.9012 114.9513,346.9082 C114.5113,346.9172 114.0093,346.8202 113.7073,346.4742 C113.4613,346.1902 113.3773,345.8022 113.3683,345.4362 C113.3623,345.2262 113.3763,345.0112 113.4043,344.8032 C113.4633,344.3602 113.5713,343.9262 113.7463,343.5132 C113.8433,343.2842 113.9623,343.0602 114.1003,342.8542 C114.5033,342.2522 115.0563,341.7532 115.7063,341.4312 C115.9973,341.2872 116.3203,341.1402 116.6553,341.0312"
                  id="Fill-197"
                  fill="#FFFFFE"
                  mask="url(#mask-2)"
                ></path>
                <path
                  d="M217.6826,341.0312 C218.3146,340.8242 219.0786,340.7652 219.6846,341.0752 C220.3736,341.4272 220.6586,342.3282 220.3306,343.0432 C220.0896,343.5702 219.6526,343.6592 219.1356,343.7572 C218.7126,343.8372 218.3296,343.9782 218.0296,344.3002 C217.7956,344.5482 217.6616,344.8782 217.5746,345.2052 C217.4586,345.6312 217.3116,346.0902 217.0336,346.4402 C216.7756,346.7642 216.3856,346.9012 215.9786,346.9082 C215.5386,346.9172 215.0366,346.8202 214.7336,346.4742 C214.4886,346.1902 214.4056,345.8022 214.3956,345.4362 C214.3896,345.2262 214.4036,345.0112 214.4306,344.8032 C214.4896,344.3602 214.5986,343.9262 214.7736,343.5132 C214.8706,343.2842 214.9896,343.0602 215.1276,342.8542 C215.5296,342.2522 216.0826,341.7532 216.7326,341.4312 C217.0246,341.2872 217.3476,341.1402 217.6826,341.0312"
                  id="Fill-198"
                  fill="#FFFFFE"
                  mask="url(#mask-2)"
                ></path>
                <path
                  d="M156.6753,458.3359 C156.6753,463.4289 153.4903,467.5549 149.5603,467.5549 L135.3443,467.5549 C131.4153,467.5549 128.2303,463.4289 128.2303,458.3359 C128.2303,453.2429 131.4153,449.1169 135.3443,449.1169 L149.5603,449.1169 C153.4903,449.1169 156.6753,453.2429 156.6753,458.3359"
                  id="Fill-199"
                  fill="#405fca"
                  mask="url(#mask-2)"
                ></path>
                <path
                  d="M211.9258,458.3359 C211.9258,463.4289 208.7408,467.5549 204.8108,467.5549 L190.5948,467.5549 C186.6668,467.5549 183.4808,463.4289 183.4808,458.3359 C183.4808,453.2429 186.6668,449.1169 190.5948,449.1169 L204.8108,449.1169 C208.7408,449.1169 211.9258,453.2429 211.9258,458.3359"
                  id="Fill-200"
                  fill="#405fca"
                  mask="url(#mask-2)"
                ></path>
              </g>
            </g>
          </svg>
          <h1>Tiny helpers</h1>
        </div>
        <div class="sidebar__body">
          <p class="sidebar__explainer">
            A collection of single-purpose online tools for web developers...
          </p>
          <nav class="sidebar__tags u-margin-bottom-l">
            <ol class="u-listReset">
              <li class="sidebar__tag">
                <a
                  href="/"
                  class="${'all' === activeTag ? 'isActive' : ''}"
                  onClick=${event => {
                    event.preventDefault();
                    setActiveTag('all');
                  }}
                  >All
                </a>
                <div class="sidebar__tagCount">${helpers.length}</div>
              </li>
              ${tags.map(
                tag =>
                  html`
                    <li class="sidebar__tag">
                      <a
                        href="/${tag.slug}"
                        class="${tag.slug === activeTag ? 'isActive' : ''}"
                        onClick=${event => {
                          event.preventDefault();
                          setActiveTag(tag.slug);
                        }}
                      >
                        ${tag.name}
                      </a>
                      <div class="sidebar__tagCount">${tag.count}</div>
                    </li>
                  `
              )}
            </ol>
          </nav>
          <div class="sidebar__broughtToYou">
            Made by Stefan Judis
          </div>
        </div>
      </div>
      <main class="canvas">
        <div class="canvas__body">
          ${activeHelpers.length
            ? html`
                <ul class="canvas-grid">
                  ${activeHelpers.map(
                    helper =>
                      html`
                        <li class="canvas-grid__item">
                          <${Helper} helper="${helper}" />
                        </li>
                      `
                  )}
                </ul>
              `
            : html`
                That's no valid tag or?
              `}
        </div>
      </main>
    </div>
  `;
}
